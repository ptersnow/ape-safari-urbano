{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { useCallback, useState } from \"react\";\nimport { useFocusEffect, useNavigation, useRoute } from \"@react-navigation/native\";\nimport { Text, VStack } from \"native-base\";\nimport { Button } from \"../components/Button\";\nimport { api } from \"../services/api\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport function Details() {\n  var route = useRoute();\n  var navigation = useNavigation();\n  var _useState = useState(-1),\n    _useState2 = _slicedToArray(_useState, 2),\n    acAmount = _useState2[0],\n    setAcAmount = _useState2[1];\n  var _useState3 = useState(-1),\n    _useState4 = _slicedToArray(_useState3, 2),\n    qaAmount = _useState4[0],\n    setQaAmount = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    isLoading = _useState6[0],\n    setIsLoading = _useState6[1];\n  var _useState7 = useState(\"\"),\n    _useState8 = _slicedToArray(_useState7, 2),\n    serviceLevel = _useState8[0],\n    setServiceLevel = _useState8[1];\n  var _useState9 = useState([]),\n    _useState10 = _slicedToArray(_useState9, 2),\n    categories = _useState10[0],\n    setCategories = _useState10[1];\n  var _useState11 = useState([]),\n    _useState12 = _slicedToArray(_useState11, 2),\n    acQuestions = _useState12[0],\n    setAcQuestions = _useState12[1];\n  var _useState13 = useState([]),\n    _useState14 = _slicedToArray(_useState13, 2),\n    qaQuestions = _useState14[0],\n    setQaQuestions = _useState14[1];\n  var _ref = route.params,\n    sidewalkId = _ref.sidewalkId,\n    sidewalkName = _ref.sidewalkName;\n  function handleQualityForm() {\n    navigation.navigate('Form', {\n      sidewalkId: sidewalkId,\n      sidewalkName: sidewalkName,\n      questions: qaQuestions\n    });\n  }\n  function handleAcessibilityForm() {\n    navigation.navigate('Form', {\n      sidewalkId: sidewalkId,\n      sidewalkName: sidewalkName,\n      questions: acQuestions\n    });\n  }\n  function fetchCategories() {\n    var _qaCategory$0$_count, _acCategory$0$_count, avgQuality, avgAccessibility, response, qaCategory, qAmount, acCategory, aAmount, total;\n    return _regeneratorRuntime.async(function fetchCategories$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            setIsLoading(true);\n            avgQuality = -1;\n            avgAccessibility = -1;\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(api.get(\"/sidewalks/\" + sidewalkId + \"/categories\"));\n          case 6:\n            response = _context.sent;\n            setCategories(response.data.categories);\n            qaCategory = response.data.categories.filter(function (e) {\n              return e.name === \"Qualidade do espaço\";\n            });\n            if (!(((_qaCategory$0$_count = qaCategory[0]._count) == null ? void 0 : _qaCategory$0$_count.questions) > 0)) {\n              _context.next = 15;\n              break;\n            }\n            _context.next = 12;\n            return _regeneratorRuntime.awrap(api.get(\"/sidewalks/\" + sidewalkId + \"/categories/\" + qaCategory[0].id + \"/answers\"));\n          case 12:\n            qAmount = _context.sent;\n            setQaAmount(qAmount.data.avg);\n            avgQuality = qAmount.data.avg;\n          case 15:\n            setQaQuestions(qaCategory[0].questions);\n            acCategory = response.data.categories.filter(function (e) {\n              return e.name === \"Acessibilidade\";\n            });\n            if (!(((_acCategory$0$_count = acCategory[0]._count) == null ? void 0 : _acCategory$0$_count.questions) > 0)) {\n              _context.next = 23;\n              break;\n            }\n            _context.next = 20;\n            return _regeneratorRuntime.awrap(api.get(\"/sidewalks/\" + sidewalkId + \"/categories/\" + acCategory[0].id + \"/answers\"));\n          case 20:\n            aAmount = _context.sent;\n            setAcAmount(aAmount.data.avg);\n            avgAccessibility = aAmount.data.avg;\n          case 23:\n            setAcQuestions(acCategory[0].questions);\n            if (avgQuality >= 0 && avgAccessibility >= 0) {\n              total = (avgQuality + avgAccessibility) / 2;\n              if (total < 0.99) {\n                setServiceLevel(\"F\");\n              } else if (total < 1.99) {\n                setServiceLevel(\"E\");\n              } else if (total < 2.99) {\n                setServiceLevel(\"D\");\n              } else if (total < 3.99) {\n                setServiceLevel(\"C\");\n              } else if (total < 4.99) {\n                setServiceLevel(\"B\");\n              } else {\n                setServiceLevel(\"A\");\n              }\n            }\n            _context.next = 30;\n            break;\n          case 27:\n            _context.prev = 27;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n          case 30:\n            _context.prev = 30;\n            setIsLoading(false);\n            return _context.finish(30);\n          case 33:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 27, 30, 33]], Promise);\n  }\n  useFocusEffect(useCallback(function () {\n    fetchCategories();\n  }, []));\n  return _jsx(VStack, {\n    flex: 1,\n    px: 4,\n    pt: 10,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    children: _jsxs(VStack, {\n      bg: \"#D2D2D2\",\n      rounded: \"2xl\",\n      space: 4,\n      w: \"full\",\n      py: 4,\n      px: 2,\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      children: [_jsx(Text, {\n        fontSize: \"3xl\",\n        fontWeight: \"bold\",\n        mb: 6,\n        children: sidewalkName\n      }), _jsx(Button, {\n        bg: \"#519657\",\n        title: \"Qualidade do espa\\xE7o\",\n        headingColor: \"white\",\n        w: \"full\",\n        isLoading: isLoading,\n        disabled: qaAmount >= 0,\n        onPress: handleQualityForm\n      }), qaAmount >= 0 && _jsx(Text, {\n        fontSize: \"xl\",\n        fontWeight: \"bold\",\n        children: qaAmount\n      }), _jsx(Button, {\n        bg: \"#26418F\",\n        title: \"Acessibilidade\",\n        headingColor: \"white\",\n        w: \"full\",\n        mt: 4,\n        isLoading: isLoading,\n        disabled: acAmount >= 0,\n        onPress: handleAcessibilityForm\n      }), acAmount >= 0 && _jsx(Text, {\n        fontSize: \"xl\",\n        fontWeight: \"bold\",\n        children: acAmount\n      }), serviceLevel != \"\" && _jsxs(VStack, {\n        w: \"full\",\n        alignItems: \"center\",\n        mb: 6,\n        children: [_jsx(Button, {\n          bg: \"#E99D09\",\n          title: \"N\\xEDvel do servi\\xE7o\",\n          headingColor: \"black\",\n          w: \"full\",\n          mt: 4,\n          disabled: true\n        }), _jsx(Text, {\n          fontSize: \"xl\",\n          fontWeight: \"bold\",\n          children: serviceLevel\n        })]\n      })]\n    })\n  });\n}","map":{"version":3,"names":["useCallback","useState","useFocusEffect","useNavigation","useRoute","Text","VStack","Button","api","Details","route","navigation","acAmount","setAcAmount","qaAmount","setQaAmount","isLoading","setIsLoading","serviceLevel","setServiceLevel","categories","setCategories","acQuestions","setAcQuestions","qaQuestions","setQaQuestions","params","sidewalkId","sidewalkName","handleQualityForm","navigate","questions","handleAcessibilityForm","fetchCategories","avgQuality","avgAccessibility","get","response","data","qaCategory","filter","e","name","_count","id","qAmount","avg","acCategory","aAmount","total","console","log"],"sources":["/home/pedro/Documentos/IFMS/projetos/ape-safari-urbano/mobile/src/screens/Details.tsx"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport { useFocusEffect, useNavigation, useRoute } from \"@react-navigation/native\";\nimport { Text, VStack } from \"native-base\";\n\nimport { Button } from \"../components/Button\";\nimport { api } from \"../services/api\";\n\nexport interface QuestionProps {\n    id: string\n    name: string\n    categoryId: string\n\n    choices: {\n        id: string\n        text: string\n        value: string\n        questionId: string\n    }[]\n\n    answers: {\n        id: string\n        userId: string\n        choice: string\n        questionId: string\n        sidewalkId: string\n    }[]\n}\n\ninterface CategoryProps {\n    id: string\n    name: string\n    questions: QuestionProps[]\n}\n\ninterface RouteParams {\n    sidewalkId: string\n    sidewalkName: string\n}\n\nexport function Details() {\n    const route = useRoute()\n    const navigation = useNavigation()\n\n    const [acAmount, setAcAmount] = useState(-1)\n    const [qaAmount, setQaAmount] = useState(-1)\n    const [isLoading, setIsLoading] = useState(false)\n    const [serviceLevel, setServiceLevel] = useState(\"\")\n\n    const [categories, setCategories] = useState<CategoryProps[]>([])\n    const [acQuestions, setAcQuestions] = useState<QuestionProps[]>([])\n    const [qaQuestions, setQaQuestions] = useState<QuestionProps[]>([])\n\n    const { sidewalkId, sidewalkName } = route.params as RouteParams\n\n    function handleQualityForm() {        \n        navigation.navigate('Form', {sidewalkId, sidewalkName, questions: qaQuestions})\n    }\n    \n    function handleAcessibilityForm() {\n        navigation.navigate('Form', {sidewalkId, sidewalkName, questions: acQuestions})\n    }\n\n    async function fetchCategories() {\n        try {\n            setIsLoading(true)\n\n            let avgQuality = -1\n            let avgAccessibility = -1\n            const response = await api.get(`/sidewalks/${sidewalkId}/categories`)\n\n            setCategories(response.data.categories)\n            \n            const qaCategory = response.data.categories.filter((e) => {\n                return e.name === \"Qualidade do espaço\"\n            })\n\n            if (qaCategory[0]._count?.questions > 0) {\n                const qAmount = await api.get(`/sidewalks/${sidewalkId}/categories/${qaCategory[0].id}/answers`)\n                setQaAmount(qAmount.data.avg)\n                avgQuality = qAmount.data.avg\n            }\n            \n            setQaQuestions(qaCategory[0].questions)\n\n            const acCategory = response.data.categories.filter((e) => {\n                return e.name === \"Acessibilidade\"\n            })\n\n            if (acCategory[0]._count?.questions > 0) {\n                const aAmount = await api.get(`/sidewalks/${sidewalkId}/categories/${acCategory[0].id}/answers`)\n                setAcAmount(aAmount.data.avg)\n                avgAccessibility = aAmount.data.avg\n            }\n\n            setAcQuestions(acCategory[0].questions)\n            \n            if (avgQuality >= 0 && avgAccessibility >= 0) {\n                const total = (avgQuality + avgAccessibility) / 2\n\n                if (total < 0.99) {\n                    setServiceLevel(\"F\")\n                } \n                else if (total < 1.99) {\n                    setServiceLevel(\"E\")\n                }\n                else if (total < 2.99) {\n                    setServiceLevel(\"D\")\n                }\n                else if (total < 3.99) {\n                    setServiceLevel(\"C\")\n                }\n                else if (total < 4.99) {\n                    setServiceLevel(\"B\")\n                }\n                else {\n                    setServiceLevel(\"A\")\n                }\n            }\n\n        } catch (error) {\n            console.log(error)\n        } finally {\n            setIsLoading(false)\n        }\n    }\n\n    useFocusEffect(useCallback(() => {\n        fetchCategories()\n    }, []))\n\n    return (\n        <VStack flex={1} px={4} pt={10} alignItems=\"center\" justifyContent=\"center\">\n\n            <VStack\n                bg=\"#D2D2D2\"\n                rounded=\"2xl\"\n                space={4}\n                w=\"full\"\n                py={4}\n                px={2}\n                alignItems=\"center\"\n                justifyContent=\"center\"\n            >\n\n                <Text fontSize=\"3xl\" fontWeight=\"bold\" mb={6}>\n                    {sidewalkName}\n                </Text>\n\n                <Button \n                    bg=\"#519657\"\n                    title=\"Qualidade do espaço\"\n                    headingColor=\"white\"\n                    w=\"full\"\n                    isLoading={isLoading}\n                    disabled={qaAmount >= 0}\n                    onPress={handleQualityForm}\n                />\n                {\n                    qaAmount >= 0 &&\n\n                    <Text fontSize=\"xl\" fontWeight=\"bold\">\n                        {qaAmount}\n                    </Text>\n                }\n                \n                <Button \n                    bg=\"#26418F\"\n                    title=\"Acessibilidade\"\n                    headingColor=\"white\"\n                    w=\"full\"\n                    mt={4}\n                    isLoading={isLoading}\n                    disabled={acAmount >= 0}\n                    onPress={handleAcessibilityForm}\n                />\n                {\n                    acAmount >= 0 &&\n                    <Text fontSize=\"xl\" fontWeight=\"bold\">\n                        {acAmount}\n                    </Text>\n                }\n\n                {\n                    serviceLevel != \"\" &&\n\n                    <VStack w=\"full\" alignItems=\"center\" mb={6}>\n                        <Button \n                            bg=\"#E99D09\"\n                            title=\"Nível do serviço\"\n                            headingColor=\"black\"\n                            w=\"full\"\n                            mt={4}\n                            disabled={true}\n                        />\n                        <Text fontSize=\"xl\" fontWeight=\"bold\">\n                            {serviceLevel}\n                        </Text>\n                    </VStack>\n                }\n            </VStack>\n        </VStack>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}